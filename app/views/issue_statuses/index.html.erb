<div class="contextual">
<%= link_to l(:label_issue_status_new), new_issue_status_path, :class => 'icon icon-add' %>
<%= link_to(l(:label_update_issue_done_ratios), update_issue_done_ratio_issue_statuses_path, :class => 'icon icon-multiple', :method => 'post', :data => {:confirm => l(:text_are_you_sure)}) if Issue.use_status_for_done_ratio? %>
</div>

<h2><%=l(:label_issue_status_plural)%></h2>

<table class="list">
  <thead><tr>
  <th><%=l(:field_status)%></th>
  <% if Issue.use_status_for_done_ratio? %>
  <th><%=l(:field_done_ratio)%></th>
  <% end %>
  <th><%=l(:field_is_closed)%></th>
  <th><%=l(:field_in_workflows)%></th>
  <th><%=l(:button_sort)%></th>
  <th></th>
  </tr></thead>
  <tbody>
<% flows = WorkflowTransition.where(role_id: Role.select(&:consider_workflow?).map(&:id)).
   joins("INNER JOIN issue_statuses ON issue_statuses.id = workflows.old_status_id OR issue_statuses.id = workflows.new_status_id").
   select("issue_statuses.id", :workspace_id, :tracker_id, :role_id).uniq.map(&:id)
   flows = flows.uniq.map{|e| [e, flows.count(e)]}.to_h %>
<% for status in @issue_statuses %>
  <tr class="<%= cycle("odd", "even") %>">
  <td class="name"><%= link_to status.name, edit_issue_status_path(status) %></td>
  <% if Issue.use_status_for_done_ratio? %>
  <td><%= status.default_done_ratio %></td>
  <% end %>
  <td><%= checked_image status.is_closed? %></td>
  <td><%= flows[status.id] %></td>
  <td class="reorder"><%= reorder_links('issue_status', {:action => 'update', :id => status, :page => params[:page]}, :put) %></td>
  <td class="buttons">
    <%= delete_link issue_status_path(status) %>
  </td>
  </tr>
<% end %>
  </tbody>
</table>

<span class="pagination"><%= pagination_links_full @issue_status_pages %></span>

<% html_title(l(:label_issue_status_plural)) -%>
